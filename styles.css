:root{
  --bg1:#f8fafc; --bg2:#eef2f7; --bg3:#e5e9f2;
  --ink:#0f172a; --muted:#64748b; --line:#e2e8f0;
  --a:#2563eb; --a-soft:#dbeafe; --b:#059669; --b-soft:#d1fae5;
}
html,body{height:100%}
body{
  margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
  color:var(--ink);
  background: linear-gradient(135deg,var(--bg1),var(--bg2) 40%, var(--bg3));
}
.wrap{max-width:980px;margin:0 auto;padding:16px 16px 28px}
.card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 4px 12px rgba(15,23,42,.04)}
.pad{padding:16px}
.pad-lg{padding:16px 16px 12px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.row-stretch{display:flex;gap:12px}
.col{flex:1 1 0}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
input[type="text"], input[type="number"], textarea, select, input[type="color"]{
  width:100%; box-sizing:border-box; padding:10px 12px; border:1px solid var(--line);
  border-radius:10px; outline:none; font-size:14px; background:#fff;
}
textarea{resize:vertical}
textarea[readonly]{background:#f8fafc;color:var(--ink)}
.btn{appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer}
.btn.primary{background:var(--b); color:#fff}
.btn.dark{background:#0f172a; color:#fff}
.btn.light{background:#f1f5f9; color:#0f172a; border:1px solid var(--line)}
.btn.warn{background:#ef4444; color:#fff}
.btn:disabled{opacity:.6; cursor:not-allowed}
.header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line);background:#f8fafc;border-radius:16px 16px 0 0}
.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;color:#fff;font-size:13px;font-weight:700}
.chip.a{background:var(--a)}
.chip.b{background:var(--b)}
.muted{color:var(--muted); font-size:12px}
.conv{max-height:460px; overflow:auto; padding:12px}
.msg-row{display:flex; gap:8px; align-items:flex-end; margin:6px 0; position:relative; z-index:0; --bubble-glow:rgba(37,99,235,.28)}
.left{justify-content:flex-start}
.right{justify-content:flex-end}
.avatar{width:36px;height:36px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:20px}
.avatar.a{background:var(--a-soft); color:#1d4ed8}
.avatar.b{background:var(--b-soft); color:#047857}
.bubble{max-width:76%; border:1px solid var(--line); border-radius:16px; padding:10px 12px; box-shadow:0 2px 6px rgba(15,23,42,.05)}
.name{font-size:11px;color:var(--muted);font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:4px}
.text{white-space:pre-wrap; line-height:1.45}
.msg-row.animate-in{animation:messageFloatIn .5s cubic-bezier(.21,1,.29,1) both}
.msg-row.animate-in::before{
  content:"";
  position:absolute;
  left:12%;
  right:12%;
  bottom:-6px;
  height:14px;
  border-radius:999px;
  background:radial-gradient(60% 100% at 50% 50%, var(--bubble-glow, rgba(37,99,235,.28)) 0%, transparent 72%);
  opacity:0;
  pointer-events:none;
  z-index:-1;
  animation:messageGlowTrail .6s ease-out both
}
.msg-row.animate-in .bubble{animation:bubbleGlow .6s ease-out both}
.msg-row.animate-in .text{animation:textReveal .5s cubic-bezier(.17,.67,.4,1) both}
@keyframes messageFloatIn{
  0%{transform:translateY(18px) scale(.95);opacity:0;filter:blur(8px)}
  55%{transform:translateY(-6px) scale(1.03);opacity:1;filter:blur(0)}
  100%{transform:translateY(0) scale(1);opacity:1;filter:blur(0)}
}
@keyframes bubbleGlow{
  0%{box-shadow:0 0 0 rgba(15,23,42,0)}
  45%{box-shadow:0 14px 36px var(--bubble-glow, rgba(37,99,235,.28))}
  100%{box-shadow:0 2px 6px rgba(15,23,42,.05)}
}
@keyframes textReveal{
  0%{opacity:0;transform:translateY(6px)}
  100%{opacity:1;transform:translateY(0)}
}
@keyframes messageGlowTrail{
  0%{opacity:0;transform:translateY(8px) scaleX(.6)}
  50%{opacity:.75;transform:translateY(0) scaleX(1)}
  100%{opacity:0;transform:translateY(-4px) scaleX(1.25)}
}
@media (prefers-reduced-motion: reduce){
  .msg-row.animate-in,.msg-row.animate-in::before,.msg-row.animate-in .bubble,.msg-row.animate-in .text{animation:none!important;filter:none!important;opacity:1!important}
}
/* typing dots */
@keyframes bounceDots {
  0%, 80%, 100% { transform: scale(0); opacity: .4; }
  40% { transform: scale(1); opacity: 1; }
}
.typing-dots span {
  display:inline-block; width:7px; height:7px; border-radius:999px; background:currentColor; margin-right:4px;
  animation:bounceDots 1.4s infinite ease-in-out both;
}
.typing-dots span:nth-child(2){ animation-delay:.2s }
.typing-dots span:nth-child(3){ animation-delay:.4s }
.section-title{padding:10px 16px;border-bottom:1px solid var(--line);background:#f8fafc;color:var(--muted);font-size:13px}
.hint{font-size:12px;color:var(--muted);padding:6px 12px 12px}
.grid2{display:grid;grid-template-columns:1fr;gap:12px}
@media (min-width:900px){ .grid2{grid-template-columns:1fr 1fr} }

/* views */
.view{display:none}
.view.active{display:block}

/* accordion */
.accordion{display:flex;flex-direction:column;gap:14px}
.accordion-item{border:1px solid var(--line);border-radius:20px;background:#fff;box-shadow:0 10px 28px rgba(15,23,42,.06);overflow:hidden;transition:box-shadow .18s ease, border-color .18s ease}
.accordion-item.open{border-color:rgba(37,99,235,.35);box-shadow:0 16px 36px rgba(37,99,235,.12)}
.accordion-header{width:100%;display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:#f8fafc;border:0;font-size:15px;font-weight:600;color:var(--ink);cursor:pointer;transition:background .18s ease}
.accordion-header:hover{background:#eef2f7}
.accordion-title{display:flex;align-items:center;gap:8px}
.accordion-icon{transition:transform .18s ease;font-size:16px}
.accordion-item:not(.open) .accordion-icon{transform:rotate(-90deg)}
.accordion-body{padding:20px;border-top:1px solid var(--line);background:#fff}
.accordion-item:not(.open) .accordion-body{display:none}

.section-stack{display:grid;gap:16px}
@media (min-width:900px){.section-stack{grid-template-columns:repeat(2,minmax(0,1fr))}}

.panel{background:#f8fafc;border:1px solid var(--line);border-radius:16px;padding:18px;display:flex;flex-direction:column;gap:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,.6)}
.panel-title{font-size:13px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);font-weight:700}

.persona-wizard{display:flex;flex-direction:column;gap:18px}
.wizard-progress{display:flex;flex-wrap:wrap;gap:10px}
.wizard-step-btn{appearance:none;border:1px solid var(--line);border-radius:999px;padding:10px 16px;background:#f1f5f9;color:var(--muted);font-weight:600;cursor:pointer;transition:all .18s ease}
.wizard-step-btn:hover{border-color:var(--a);color:var(--ink)}
.wizard-step-btn.active{background:var(--a);color:#fff;border-color:var(--a);box-shadow:0 10px 24px rgba(37,99,235,.22)}
.wizard-panels{border:1px dashed rgba(148,163,184,.6);border-radius:18px;padding:18px;background:#fbfdff}
.wizard-panel{display:none}
.wizard-panel.active{display:block}
.wizard-nav{margin-top:18px;display:flex;gap:12px;justify-content:flex-end;flex-wrap:wrap}
.wizard-review{display:grid;gap:14px}
@media (min-width:900px){.wizard-review{grid-template-columns:repeat(3,minmax(0,1fr))}}
.review-card{border:1px solid var(--line);border-radius:16px;padding:14px 16px;background:#fff;box-shadow:0 6px 18px rgba(15,23,42,.06);display:flex;flex-direction:column;gap:8px}
.review-title{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700}
.review-name{font-size:15px;font-weight:700;color:var(--ink)}
.review-detail{font-size:13px;color:var(--muted);line-height:1.45;white-space:pre-wrap}

/* history list */
.history-list{max-height:200px;overflow:auto;padding:8px 12px;display:grid;gap:8px}
.hist-item{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);border-radius:10px;padding:8px 10px;background:#fff}
.hist-title{font-size:13px}
.hist-item.active{border-color:var(--a);box-shadow:0 4px 12px rgba(37,99,235,.12)}

.chat-layout{display:flex;gap:16px;align-items:stretch}
.chat-main{flex:1 1 auto;min-width:0}
.conversation-card{display:flex;flex-direction:column}
.conversation-card .conv{flex:1 1 auto}
.conversation-card .pad{border-top:1px solid var(--line)}
.conversation-summary{display:flex;gap:12px;justify-content:center;align-items:center;padding:14px 16px;border-bottom:1px solid var(--line);background:#f8fafc;flex-wrap:wrap}
.summary-chip{position:relative;display:inline-flex;align-items:center;gap:6px;padding:8px 14px;border-radius:999px;background:#f1f5f9;font-size:13px;font-weight:600;color:var(--ink)}
.summary-chip.topic{background:#e0f2fe}
.summary-emoji{font-size:16px}
.summary-detail{position:absolute;top:calc(100% + 10px);left:50%;transform:translate(-50%, -6px);background:#0f172a;color:#fff;padding:12px 14px;border-radius:12px;font-size:12px;line-height:1.45;min-width:220px;max-width:260px;box-shadow:0 12px 28px rgba(15,23,42,.24);opacity:0;pointer-events:none;transition:opacity .18s ease, transform .18s ease;z-index:20}
.summary-detail::before{content:"";position:absolute;top:-8px;left:50%;transform:translateX(-50%);border-width:8px;border-style:solid;border-color:transparent transparent #0f172a transparent}
.summary-chip:hover .summary-detail{opacity:1;transform:translate(-50%,0)}

.memory-bar{flex:0 0 240px;display:flex;flex-direction:column;max-height:100%}
.memory-header{padding:14px 16px;border-bottom:1px solid var(--line);background:#f8fafc;color:var(--muted);font-size:13px;font-weight:600;border-radius:16px 16px 0 0}
.memory-list{flex:1 1 auto;padding:12px;overflow:auto;display:flex;flex-direction:column;gap:10px}
.memory-item{display:flex;flex-direction:column;align-items:flex-start;text-align:left;border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;cursor:pointer;transition:border-color .18s ease, box-shadow .18s ease;gap:4px}
.memory-item:hover{border-color:var(--a);box-shadow:0 6px 16px rgba(37,99,235,.12)}
.memory-item.active{border-color:var(--a);box-shadow:0 8px 20px rgba(37,99,235,.16)}
.memory-title{font-size:13px;font-weight:600}
.memory-meta{font-size:11px;color:var(--muted)}
.memory-empty{border:1px dashed var(--line);border-radius:12px;padding:16px;text-align:center}

@media (max-width:960px){
  .chat-layout{flex-direction:column}
  .memory-bar{flex:1 1 auto;width:100%}
  .memory-header{border-radius:16px 16px 0 0}
}
